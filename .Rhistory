suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform'))[i,]
aux3 <- rbind(aux3, aux4)
}
}
View(aux)
View(aux3)
for(i in 1:nrow(wc22_quarter)){
aux <- data.frame()
aux2 <- data.frame()
aux3 <- data.frame()
aux4 <- data.frame()
# Home team
if(wc22_quarter$home_team[i] %in% wc22_round_16$home_team){
aux <- rbind(aux, (left_join(wc22_quarter, wc22_round_16,
c("home_team" =  'home_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform'))[i,])
} else {
aux2 <- (left_join(wc22_quarter, wc22_round_16,
c("home_team" =  'away_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform'))[i,]
colnames(aux2) <-
c('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform')
aux <- rbind(aux, aux2)
}
# # Away team
# if(wc22_quarter$away_team[i] %in% wc22_round_16$home_team){
#
#   aux3 <- (left_join(wc22_quarter, wc22_round_16,
#                                c("away_team" =  'home_team'),
#                                suffix = c('', '.x')) %>%
#     select('match', 'home_team', 'away_team', 'home_team_stats_score',
#            'home_team_ranking', 'home_team_wc_perform'))[i,]
#
#   colnames(aux3) <-
#     c('match', 'home_team', 'away_team', 'away_team_stats_score',
#       'away_team_ranking', 'away_team_wc_perform')
#
# } else {
#   aux4 <- (left_join(wc22_quarter, wc22_round_16,
#                      c("away_team" =  'away_team'),
#                      suffix = c('', '.x')) %>%
#     select('match', 'home_team', 'away_team', 'away_team_stats_score',
#            'away_team_ranking', 'away_team_wc_perform'))[i,]
#
#   aux3 <- rbind(aux3, aux4)
# }
}
aux <- data.frame()
aux2 <- data.frame()
aux3 <- data.frame()
aux4 <- data.frame()
for(i in 1:nrow(wc22_quarter)){
# Home team
if(wc22_quarter$home_team[i] %in% wc22_round_16$home_team){
aux <- rbind(aux, (left_join(wc22_quarter, wc22_round_16,
c("home_team" =  'home_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform'))[i,])
} else {
aux2 <- (left_join(wc22_quarter, wc22_round_16,
c("home_team" =  'away_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform'))[i,]
colnames(aux2) <-
c('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform')
aux <- rbind(aux, aux2)
}
# # Away team
# if(wc22_quarter$away_team[i] %in% wc22_round_16$home_team){
#
#   aux3 <- (left_join(wc22_quarter, wc22_round_16,
#                                c("away_team" =  'home_team'),
#                                suffix = c('', '.x')) %>%
#     select('match', 'home_team', 'away_team', 'home_team_stats_score',
#            'home_team_ranking', 'home_team_wc_perform'))[i,]
#
#   colnames(aux3) <-
#     c('match', 'home_team', 'away_team', 'away_team_stats_score',
#       'away_team_ranking', 'away_team_wc_perform')
#
# } else {
#   aux4 <- (left_join(wc22_quarter, wc22_round_16,
#                      c("away_team" =  'away_team'),
#                      suffix = c('', '.x')) %>%
#     select('match', 'home_team', 'away_team', 'away_team_stats_score',
#            'away_team_ranking', 'away_team_wc_perform'))[i,]
#
#   aux3 <- rbind(aux3, aux4)
# }
}
aux <- data.frame()
aux2 <- data.frame()
aux3 <- data.frame()
aux4 <- data.frame()
for(i in 1:nrow(wc22_quarter)){
# Home team
if(wc22_quarter$home_team[i] %in% wc22_round_16$home_team){
aux <- rbind(aux, (left_join(wc22_quarter, wc22_round_16,
c("home_team" =  'home_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform'))[i,])
} else {
aux2 <- (left_join(wc22_quarter, wc22_round_16,
c("home_team" =  'away_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform'))[i,]
colnames(aux2) <-
c('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform')
aux <- rbind(aux, aux2)
}
# Away team
if(wc22_quarter$away_team[i] %in% wc22_round_16$home_team){
aux3 <- (left_join(wc22_quarter, wc22_round_16,
c("away_team" =  'home_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform'))[i,]
colnames(aux3) <-
c('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform')
} else {
aux4 <- (left_join(wc22_quarter, wc22_round_16,
c("away_team" =  'away_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform'))[i,]
aux3 <- rbind(aux3, aux4)
}
}
View(aux3)
View(aux)
View(aux4)
View(aux3)
aux <- data.frame()
aux2 <- data.frame()
aux3 <- data.frame()
aux4 <- data.frame()
for(i in 1:nrow(wc22_quarter)){
# Home team
if(wc22_quarter$home_team[i] %in% wc22_round_16$home_team){
aux <- rbind(aux, (left_join(wc22_quarter, wc22_round_16,
c("home_team" =  'home_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform'))[i,])
} else {
aux2 <- (left_join(wc22_quarter, wc22_round_16,
c("home_team" =  'away_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform'))[i,]
colnames(aux2) <-
c('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform')
aux <- rbind(aux, aux2)
}
# Away team
if(wc22_quarter$away_team[i] %in% wc22_round_16$home_team){
aux3 <- rbind(aux3, (left_join(wc22_quarter, wc22_round_16,
c("away_team" =  'home_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform'))[i,])
colnames(aux3) <-
c('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform')
} else {
aux4 <- (left_join(wc22_quarter, wc22_round_16,
c("away_team" =  'away_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform'))[i,]
aux3 <- rbind(aux3, aux4)
}
}
rbind(aux3, (left_join(wc22_quarter, wc22_round_16,
c("away_team" =  'home_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform'))[i,])
aux_home <- data.frame()
aux_away <- data.frame()
aux <- data.frame()
aux2 <- data.frame()
aux3 <- data.frame()
aux4 <- data.frame()
for(i in 1:nrow(wc22_quarter)){
# Home team
if(wc22_quarter$home_team[i] %in% wc22_round_16$home_team){
aux <- rbind(aux, (left_join(wc22_quarter, wc22_round_16,
c("home_team" =  'home_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform'))[i,])
} else {
aux2 <- (left_join(wc22_quarter, wc22_round_16,
c("home_team" =  'away_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform'))[i,]
colnames(aux2) <-
c('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform')
aux_home <- rbind(aux, aux2)
}
# Away team
if(wc22_quarter$away_team[i] %in% wc22_round_16$home_team){
aux3 <- (left_join(wc22_quarter, wc22_round_16,
c("away_team" =  'home_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform'))[i,]
colnames(aux3) <-
c('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform')
} else {
aux4 <- (left_join(wc22_quarter, wc22_round_16,
c("away_team" =  'away_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform'))[i,]
aux_away <- rbind(aux3, aux4)
}
}
View(aux_home)
rbind(aux_away, aux3, aux4)
aux_home <- data.frame()
aux_away <- data.frame()
aux <- data.frame()
aux2 <- data.frame()
aux3 <- data.frame()
aux4 <- data.frame()
for(i in 1:nrow(wc22_quarter)){
# Home team
if(wc22_quarter$home_team[i] %in% wc22_round_16$home_team){
aux <- rbind(aux, (left_join(wc22_quarter, wc22_round_16,
c("home_team" =  'home_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform'))[i,])
} else {
aux2 <- (left_join(wc22_quarter, wc22_round_16,
c("home_team" =  'away_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform'))[i,]
colnames(aux2) <-
c('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform')
aux_home <- rbind(aux_home, aux, aux2)
}
# Away team
if(wc22_quarter$away_team[i] %in% wc22_round_16$home_team){
aux3 <- (left_join(wc22_quarter, wc22_round_16,
c("away_team" =  'home_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform'))[i,]
colnames(aux3) <-
c('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform')
} else {
aux4 <- (left_join(wc22_quarter, wc22_round_16,
c("away_team" =  'away_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform'))[i,]
aux_away <- rbind(aux_away, aux3, aux4)
}
}
View(aux_home)
View(aux_away)
View(aux)
View(aux_away)
aux_home <- data.frame()
aux_away <- data.frame()
aux <- data.frame()
aux2 <- data.frame()
aux3 <- data.frame()
aux4 <- data.frame()
for(i in 1:nrow(wc22_quarter)){
# Home team
if(wc22_quarter$home_team[i] %in% wc22_round_16$home_team){
aux <- rbind(aux, (left_join(wc22_quarter, wc22_round_16,
c("home_team" =  'home_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform'))[i,])
} else {
aux2 <- (left_join(wc22_quarter, wc22_round_16,
c("home_team" =  'away_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform'))[i,]
colnames(aux2) <-
c('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform')
}
aux_home <- rbind(aux_home, aux, aux2)
# Away team
if(wc22_quarter$away_team[i] %in% wc22_round_16$home_team){
aux3 <- (left_join(wc22_quarter, wc22_round_16,
c("away_team" =  'home_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform'))[i,]
colnames(aux3) <-
c('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform')
} else {
aux4 <- (left_join(wc22_quarter, wc22_round_16,
c("away_team" =  'away_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform'))[i,]
}
aux_away <- rbind(aux_away, aux3, aux4)
}
View(aux_home)
aux_home <- data.frame()
aux_away <- data.frame()
aux <- data.frame()
aux2 <- data.frame()
aux3 <- data.frame()
aux4 <- data.frame()
for(i in 1:nrow(wc22_quarter)){
# Home team
if(wc22_quarter$home_team[i] %in% wc22_round_16$home_team){
aux <- rbind(aux, (left_join(wc22_quarter, wc22_round_16,
c("home_team" =  'home_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform'))[i,])
} else {
aux2 <- (left_join(wc22_quarter, wc22_round_16,
c("home_team" =  'away_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform'))[i,]
colnames(aux2) <-
c('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform')
}
aux_home <- distinct(rbind(aux_home, aux, aux2))
# Away team
if(wc22_quarter$away_team[i] %in% wc22_round_16$home_team){
aux3 <- (left_join(wc22_quarter, wc22_round_16,
c("away_team" =  'home_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform'))[i,]
colnames(aux3) <-
c('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform')
} else {
aux4 <- (left_join(wc22_quarter, wc22_round_16,
c("away_team" =  'away_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform'))[i,]
}
aux_away <- distinct(rbind(aux_away, aux3, aux4))
}
View(aux_away)
View(aux_home)
teste <- cbind(aux_home, aux_away)
View(teste)
?'cbind'
aux_home <- data.frame()
aux_away <- data.frame()
aux <- data.frame()
aux2 <- data.frame()
aux3 <- data.frame()
aux4 <- data.frame()
for(i in 1:nrow(wc22_quarter)){
# Home team
if(wc22_quarter$home_team[i] %in% wc22_round_16$home_team){
aux <- rbind(aux, (left_join(wc22_quarter, wc22_round_16,
c("home_team" =  'home_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform'))[i,])
} else {
aux2 <- (left_join(wc22_quarter, wc22_round_16,
c("home_team" =  'away_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform'))[i,]
colnames(aux2) <-
c('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform')
}
aux_home <- distinct(rbind(aux_home, aux, aux2))
# Away team
if(wc22_quarter$away_team[i] %in% wc22_round_16$home_team){
aux3 <- (left_join(wc22_quarter, wc22_round_16,
c("away_team" =  'home_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform'))[i,]
colnames(aux3) <-
c('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform')
} else {
aux4 <- (left_join(wc22_quarter, wc22_round_16,
c("away_team" =  'away_team'),
suffix = c('', '.x')) %>%
select('match', 'home_team', 'away_team', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform'))[i,]
}
aux_away <- distinct(rbind(aux_away, aux3, aux4))
}
teste <- cbind(aux_home, aux_away) %>%
select('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform'))
teste <- cbind(aux_home, aux_away) %>%
select('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform')
View(teste)
wc22_quarter <- cbind(aux_home, aux_away) %>%
select('match', 'home_team', 'away_team', 'home_team_stats_score',
'home_team_ranking', 'home_team_wc_perform', 'away_team_stats_score',
'away_team_ranking', 'away_team_wc_perform')
View(wc22_quarter)
# Adding results from the model to the dataset
wc22_quarter$prediction <- predict(wc_model_step, newdata = wc22_quarter,
type = "class")
# Adding results from the model to the dataset
wc22_quarter$prediction <- predict(wc_model_step, newdata = wc22_quarter,
type = "class")
predict(wc_model_step, newdata = wc22_quarter,
type = "class")
predict(wc_model_step, newdata = wc22_round_16,
type = "class")
predict(wc_model_step, newdata = wc22_quarter,
type = "class")
predict(wc_model_step, newdata = wc22_quarter,
type = "prob")
# Performance in past matches and in World Cups
for (j in 1:nrow(wc22_quarter)){
# Performance in past matches
home_team_victories <-
wc22_quarter$home_team[j] == (match_history$winner[
(wc22_quarter$home_team[j] == match_history$home_team |
wc22_quarter$home_team[j] == match_history$away_team) &
(wc22_quarter$away_team[j] == match_history$home_team |
wc22_quarter$away_team[j] == match_history$away_team)])
wc22_quarter$home_team_perform_hist[j] <-
ifelse(length(home_team_victories) == 0, 0,
sum(home_team_victories, na.rm = TRUE)/length(home_team_victories))
away_team_victories <-
wc22_quarter$away_team[j] == (match_history$winner[
(wc22_quarter$home_team[j] == match_history$home_team |
wc22_quarter$home_team[j] == match_history$away_team) &
(wc22_quarter$away_team[j] == match_history$home_team |
wc22_quarter$away_team[j] == match_history$away_team)])
wc22_quarter$away_team_perform_hist[j] <-
ifelse(length(away_team_victories) == 0, 0,
sum(away_team_victories, na.rm = TRUE)/length(away_team_victories))
}
# Adding results from the model to the dataset
wc22_quarter$prediction <- predict(wc_model_step, newdata = wc22_quarter,
type = "class")
result_prob <- predict(wc_model_step, newdata = wc22_quarter,
type = "prob")
colnames(result_prob) <- c('draw_prob', 'away_prob', 'home_prob')
wc22_quarter <- cbind(wc22_quarter, result_prob)
wc22_quarter %>%
select(home_team, away_team, prediction) %>%
kable() %>%
kable_styling(bootstrap_options = "striped",
full_width = F,
font_size = 22)
for(i in 1:nrow(wc22_quarter)){
if (wc22_quarter$prediction[i] == 'draw'){
wc22_quarter$prediction[i] <-
ifelse(wc22_quarter$home_prob[i] > wc22_quarter$away_prob[i],
'home_team', 'away_team')
}
aux$country <- wc22_quarter[i,as.character(wc22_quarter$prediction[i])]
aux$match <- wc22_quarter$match[i]
classified_quarter <- rbind(classified_quarter, aux)
}
# Classified - quarter
classified_quarter <- data.frame()
aux <- data.frame('country' = NA, 'match' = NA)
for(i in 1:nrow(wc22_quarter)){
if (wc22_quarter$prediction[i] == 'draw'){
wc22_quarter$prediction[i] <-
ifelse(wc22_quarter$home_prob[i] > wc22_quarter$away_prob[i],
'home_team', 'away_team')
}
aux$country <- wc22_quarter[i,as.character(wc22_quarter$prediction[i])]
aux$match <- wc22_quarter$match[i]
classified_quarter <- rbind(classified_quarter, aux)
}
View(classified_quarter)
